{% extends "base.html" %}
{% block title %}Informes de eficiencia energética en XML - Validador de informes{% endblock %}

{% block page_content %}
<div class="page-header">
  <h1>Validador de informes en formato XML</h1>
</div>
<div class="page">

  <p>Validación de un archivo de informe de eficiencia energética en formato XML (normalmente 'Informe.xml') con el esquema de datos <a href="{{ url_for('static', filename='validador/DatosEnergeticosDelEdificioSchema20.xsd') }}">DatosEnergeticosDelEdifico20.xsd</a>.</p>

  <p>Puede probar la validación con un <a href="{{ url_for('static', filename='validador/EjemploTerciario.xml') }}">informe de ejemplo de edificio con uso terciario</a> o con un <a href="{{ url_for('static', filename='validador/EjemploResidencial.xml') }}">informe de ejemplo de edificio con uso residencial</a>.</p>

  <div class="panel panel-default">
    <div class="panel-heading">Seleccione un archivo de informe de eficiencia energética en XML</div>
    <div class="panel-body">
      <form class="form" action="" role="form" method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <div class="form-group">
          {{ form.file.label }}
          {{ form.file }}
          <p class="help-block">{{ form.file.description }}</p>
          {% if form.file.errors %}
          <ul>
            {% for error in form.file.errors %}
            <p class="text-danger">{{ error }}</p>
            {% endfor %}
            </ul>
          {% endif %}
        </div>
        {{ form.submit(class='btn btn-default') }}
      </form>
    </div>
  </div>

  {% if session['storedfilename'] %}

  {% if session['validationerrors'] %}
  <div class="alert alert-danger">
    Se han encontrado errores en la validación.
  </div>
  <h2>Resultado de la validación</h2>
  <p>Se han encontrado <strong>{{ session['validationerrors']|length }}</strong> errores de validación en el archivo {{ session['filename'] }}:</p>
  <div class="well">
    {% for (linenumber, message) in session['validationerrors'] %}
    <strong>Línea {{ linenumber }}:</strong> {{ message }}<br />
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-success">
    <p>El informe activo, <b>{{ session['filename'] }}</b>, no contiene errores de validación.</p>
    <p>Puede <a href="{{ url_for('visor')}}" class="alert-link">ver su contenido</a> o seleccionar un nuevo informe para su validación.</p>
  </div>
  {% endif %}

  {% if session['info'] %}
  <div class="alert alert-warning">
    <h2>Avisos de validación</h2>
    <p>Se han encontrado <strong>{{ session['info']|length }}</strong> avisos de validación:</p>
    <div class="well">
      {% for (messagetype, message) in session['info'] %}
      <strong>{{ messagetype }}:</strong> {{ message }}<br />
      {% endfor %}
    </div>
  </div>
  {% endif %}


  {% else %}
  <div class="alert alert-warning">
    <p>No existe un informe activo.</p>
  </div>
  {% endif %}

</div>
{% endblock %}
